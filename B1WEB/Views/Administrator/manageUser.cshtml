@{
    ViewData["Title"] = "Sales Order List";
}

@section CSS {
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css" />
    <!--datatable responsive css-->
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap.min.css" />

    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css">
}



<div class="container-fluid">
    <div class="row">

        <div class="col-12">
            <div class="row">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex align-items-center">
                            <h5 style="font-size:32px" class="card-title mb-0 flex-grow-1">Users List</h5>
                            <div class="flex-shrink-0">
                                <div class="d-flex gap-2 flex-wrap">
                                    @*    <button class="btn btn-primary" id="remove-actions" onclick="deleteMultiple()" style="display: none;"><i class="ri-delete-bin-2-line"></i></button> *@
                                    <a class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#AddUserModal"><i class="ri-add-line align-bottom me-1"></i> Create A User</a>
                                </div>
                            </div>
                        </div>
                        @*   <h5 class="card-title mb-0">  Sales Order List <a style="float:right" href="/Sales/AddSaleOrder" class="btn btn-primary btn-sm"> <i class="ri-file-add-line"></i> Add Sale Order</a></h5> *@
                    </div>
                    <div class="card-body">
                        <table id="fixed-header" class="table table-bordered dt-responsive nowrap table-striped align-middle" style="width:100%">
                            <thead class="tablegrid">
                                <tr>

                                    <th>Sr #</th>
                                    <th>User Id</th>
                                    <th>Picture</th>
                                    <th>User Name</th>
                                    <th>Date of Birth</th>
                                    <th>CNIC</th>
                                    <th>Email</th>
                                    <th>Phone #</th>
                                    <th>Created At</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="fixed-headertbody">
                          

                            </tbody>
                        </table>
                    </div>
                </div>
            </div><!--end row-->

        </div>

    </div>
</div>


<!-- Grids in modals -->

<div class="modal fade" id="AddUserModal" tabindex="-1" aria-labelledby="AddUserModalLabel" aria-modal="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="AddUserModalLabel">Create A User</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="javascript:void(0);">
                    <div class="row g-3">
                        <div class="col-lg-6">
                            <div>
                                <label for="firstName" class="form-label">First Name</label>
                                <input type="text" class="form-control" id="firstName" placeholder="Enter firstname">
                            </div>
                        </div><!--end col-->
                        <div class="col-lg-6">
                            <div>
                                <label for="lastName" class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="lastName" placeholder="Enter lastname">
                            </div>
                        </div><!--end col-->
                        <div class="col-lg-6">
                            <div>
                                <label for="emailInput" class="form-label">UserName</label>
                                <input type="text" class="form-control" id="UserName" placeholder="Enter User Name">
                            </div>
                        </div><!--end col-->
                        <div class="col-lg-6">
                            <div>
                                <label for="passwordInput" class="form-label">Phone #</label>
                                <input type="text" class="form-control" id="fatherName" placeholder="Enter Phone">
                            </div>
                        </div><!--end col--> 
                        <div class="col-lg-6">
                            <div>
                                <label for="passwordInput" class="form-label">CNIC</label>
                                <input type="text" class="form-control" id="CNIC" placeholder="CNIC">
                            </div>
                        </div><!--end col-->
                        <div class="col-lg-6">
                            <div>
                                <label for="emailInput" class="form-label">Email</label>
                                <input type="email" class="form-control" id="emailInput" placeholder="Enter Email">
                            </div>
                        </div><!--end col-->
                        <div class="col-lg-6">
                            <div>
                                <label for="passwordInput" class="form-label">Password</label>
                                <input type="password" class="form-control" id="passwordInput" value="451326546">
                            </div>
                        </div><!--end col-->
                        <div class="col-lg-6">
                            <label for="genderInput" class="form-label">Gender</label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="option1">
                                    <label class="form-check-label" for="inlineRadio1">Male</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="option2">
                                    <label class="form-check-label" for="inlineRadio2">Female</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio3" value="option3">
                                    <label class="form-check-label" for="inlineRadio3">Others</label>
                                </div>
                            </div>
                        </div><!--end col-->  
                        <div class="col-lg-6">
                            <label class="form-check-label" for="IsAdmin">IsAdmin</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="IsAdmin" checked="">
                           
                            </div>
                        </div><!--end col-->
                      
                        <div class="col-lg-12">
                            <div class="hstack gap-2 justify-content-end">
                                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Submit</button>
                            </div>
                        </div><!--end col-->
                    </div><!--end row-->
                </form>
            </div>
        </div>
    </div>
</div>



@section Script {
    <!--datatable js-->


    <script src="~/cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="~/cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
    <script src="~/cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
    <script src="~/cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="~/cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>
    <script src="~/cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
    @*     <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
 *@

    <script>

        $(document).ready(function () {
            GetUserList();
        });
        function GetUserList() {
            var url = "/api/PortalUsers/GetAll";
            debugger;

            $.ajax({
                type: 'GET',
                url: url,
                dataType: "json",
                contentType: 'application/json',
                success: function (response) {

                    if (response.code == 100) {

                        var relist = response.data;
                        var datatabl = $('#fixed-header').DataTable();
                        datatabl.destroy();
                        $("#fixed-headertbody").empty();
                        if (relist != null && relist.length > 0) {
                            var sr = 1;
                            for (let list of relist) {
                                var row = '<tr>' +
                                    '<td>' + sr + '</td>' +
                                    '<td>' + list.id + '</td>' +
                                    '<td></td>' +
                                    '<td>' + list.userName + '</td>' +
                                    '<td>' + DateFormat(list.dob) + '</td>' +
                                    '<td>' + list.cnic + '</td>' +
                                    '<td>' + list.email + '</td>' +
                                    '<td>' + list.phone + '</td>' +
                                    '<td>' + DateFormat(list.createdOn) + '</td>' +
                                    '<td> <a onclick="ViewUser(' + list.id + ')" class="btn btn-sm btn-secondary"><i class="ri-eye-fill align-bottom me-2" "></i></a><a class="btn btn-sm btn-primary"><i class="ri-pencil-fill align-bottom me-2"></i></a><a class="btn btn-sm btn-danger"><i class="ri-delete-bin-fill align-bottom me-2"></i></a></td>' +
                                    '</tr>';
                                $("#fixed-headertbody").append(row);
                                sr++;

                            }

                            $("#fixed-header").dataTable({ dom: "Bfrtip", buttons: ["copy", "csv", "excel", "print", "pdf"] });
                        }
                    }
                }
            });
        }


        function DateFormat(datedata){
            var dateString = datedata;

            // Create a new Date object from the input string
            var date = new Date(dateString);

            // Extract the date components
            var year = date.getFullYear();
            var month = ('0' + (date.getMonth() + 1)).slice(-2); // Adding 1 because getMonth() returns zero-based index
            var day = ('0' + date.getDate()).slice(-2);

            // Construct the desired format
            var formattedDate = year + '-' + month + '-' + day;
            return formattedDate;
        }

        function ViewUser(id) {
            var url = "/api/PortalUsers/Get?id=" + id + "";

            $.ajax({
                type: 'GET',
                url: url,
                dataType: "json",
                data: { id: id },
                async: false,
                contentType: 'application/json',
                success: function (response) {
                    debugger;
                    if (response.code === 100) {

                        var data = response.data;
                        let status = data.isActive == true ? "1" : "0";

                        $("#myModal").modal("show");

                        $("#ID").val(data.id);
                        $("#username").val(data.username);
                        $("#designation").val(data.desiG_DESC);
                        $("#Department").val(data.departmenT_DESC);
                        $("#Department").trigger('change');
                        $("#fathername").val(data.emP_FATHER_NAM);
                        $("#employeecode").val(data.emP_CODE);
                        $("#employeename").val(data.emP_FULL_NAME);
                        $("#cnic").val(data.niC_NO);
                        $("#Status").val(status);
                        $("#SubmitButton").text("Update");
                        $("#myModalLabel").text("Edit User");
                    }
                    else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Problem Finding User',
                            allowOutsideClick: false,
                            allowEscapeKey: false
                        });
                    }
                }
            });
        }
    </script>
}